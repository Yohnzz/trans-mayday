<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRANS • Sistem Hitung Gaji</title>

<style>
:root{
  --kuning:#facc15;
  --kuning-soft:#fde047;
  --gelap:#020617;
  --gelap-2:#0f172a;
}
* {
    box-sizing: border-box;
}

body{
  font-family:Inter,Arial,sans-serif;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#e5e7eb;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:flex-start;
   overflow-x: hidden;
  padding:30px;
}
.app{
  width:100%;
  max-width:620px;
  background:#020617;
  border:2px solid var(--kuning);
  border-radius:18px;
  padding:22px;
  box-shadow:0 0 40px rgba(250,204,21,.25);
}
h1{
  text-align:center;
  color:var(--kuning);
  margin-bottom:6px;
}
.subtitle{
  text-align:center;
  color:#94a3b8;
  font-size:14px;
  margin-bottom:18px;
}
label{
  margin-top:12px;
  display:block;
  font-weight:600;
  color:#fde68a;
}
select,textarea,button{
  width:100%;
  margin-top:6px;
  padding:10px 12px;
  border-radius:10px;
  border:none;
  outline:none;
  background:#0f172a;
  color:#e5e7eb;
  font-size:14px;
}
textarea{min-height:90px}
button{
  background:linear-gradient(135deg,var(--kuning),var(--kuning-soft));
  color:#020617;
  font-weight:800;
  cursor:pointer;
  margin-top:14px;
}
button.secondary{
  background:#020617;
  border:1px solid var(--kuning);
  color:var(--kuning);
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.loading{
  display:none;
  text-align:center;
  margin-top:10px;
  font-size: 14px;
  color:var(--kuning);
}
.spinner{
  width:28px;height:28px;
  border:4px solid #334155;
  border-top:4px solid var(--kuning);
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:8px auto;
}
@keyframes spin{to{transform:rotate(360deg)}}
pre{
  background:#020617;
  border:1px dashed var(--kuning);
  border-radius:12px;
  padding:14px;
  margin-top:14px;
  white-space:pre-wrap;
  font-size:13px;
}
.badge{
  display:inline-block;
  background:var(--kuning);
  color:#020617;
  padding:4px 10px;
  border-radius:999px;
  font-weight:800;
  font-size:12px;
  margin-bottom:6px;
}

/* =========================
   RESPONSIVE SYSTEM
========================= */

/* Small devices (HP) */
@media (max-width: 480px) {
  body {
    padding: 14px;
  }

  .app {
    padding: 16px;
    border-radius: 14px;
  }

  h1 {
    font-size: 20px;
  }

  .subtitle {
    font-size: 12px;
  }

  .row {
    grid-template-columns: 1fr;
  }

  button {
    font-size: 14px;
    min-height: 44px; 
    padding: 12px;
  }

  textarea {
    min-height: 80px;
  }

  input, select, textarea {
  font-size: 16px;
}

  pre {
    font-size: 12px;
  }
}

/* Medium devices (Tablet) */
@media (min-width: 481px) and (max-width: 768px) {
  .app {
    max-width: 90%;
  }

  h1 {
    font-size: 22px;
  }

  .row {
    grid-template-columns: 1fr 1fr;
  }
}

/* Large devices (Laptop+) */
@media (min-width: 1024px) {
  .app {
    max-width: 640px;
  }

  h1 {
    font-size: 26px;
  }
}


</style>
</head>

<body>
<div class="app">

<h1>TRANS GAJIAN</h1>
<div class="subtitle">Silahkan Masukkan Data gaji</div>

<span class="badge">DATA PETUGAS</span>

<label>Nama Petugas</label>
<select id="employeeSelect">
  <option value="">— Pilih Petugas —</option>
</select>

<div class="loading" id="employeeLoading">
  Memuat petugas...
  <div class="spinner"></div>
</div>

<div class="row">
  <div>
    <label>Jabatan</label>
    <select id="jabatan" disabled>
      <option value="">— Jabatan —</option>
      <option>MAGANG</option>
      <option>JUNIOR</option>
      <option>SENIOR</option>
      <option>SUPERVISOR</option>
      <option>WAKIL TRANS</option>
      <option>CEO TRANS</option>
    </select>
  </div>
  <div>
    <label>Tombol Akses</label>
    <button class="secondary" onclick="tambahPetugas()">+ Tambah Petugas</button>
    <button class="secondary" style="margin-top:6px" onclick="editPetugas()">✏️ Edit Petugas</button>
  </div>
</div>

<span class="badge" style="margin-top:14px">DUTY</span>

<label>Riwayat Duty</label>
<textarea id="riwayat" placeholder="20.00 - 22.00"></textarea>

<button onclick="hitungGaji()">Hitung Gaji</button>

<div class="loading" id="loading">
  Menghitung gaji...
  <div class="spinner"></div>
</div>

<pre id="output"></pre>
<button class="secondary" onclick="copyText()">Copy Format Discord</button>

</div>

<script>
const API_PUBLIC = 'http://127.0.0.1:8000/api';
const API_PRIVATE = 'http://127.0.0.1:8000/api/elpetugasanjirrr';
const mention = '<@1373210207332864031> <@880374274442022912>';

let employeeLoaded = false;
const employeeSelect = document.getElementById('employeeSelect');

employeeSelect.addEventListener('focus', loadEmployees);
employeeSelect.addEventListener('change', e=>{
  const opt = e.target.selectedOptions[0];
  document.getElementById('jabatan').value =
    opt?.dataset?.jabatan || '';
});

async function loadEmployees(){
  if(employeeLoaded) return;

  const loading = document.getElementById('employeeLoading');
  loading.style.display='block';

  const res = await fetch(API_PRIVATE+'/employees');
  const data = await res.json();

  employeeSelect.innerHTML='<option value="">— Pilih Petugas —</option>';
  data.forEach(e=>{
    const opt=document.createElement('option');
    opt.value=e.id;
    opt.textContent=e.nama;
    opt.dataset.jabatan=e.jabatan;
    employeeSelect.appendChild(opt);
  });

  loading.style.display='none';
  employeeLoaded=true;
}

async function hitungGaji(){
  const loading = document.getElementById('loading');
  const output = document.getElementById('output');
  loading.style.display='block';
  output.textContent='';

  const employeeId = employeeSelect.value;
  if(!employeeId){
    loading.style.display='none';
    return alert('Pilih petugas dulu');
  }

  const riwayat = document
    .getElementById('riwayat')
    .value.split('\n')
    .filter(Boolean);

  const res = await fetch(API_PUBLIC+'/hitung-gaji',{
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Accept':'application/json'
    },
    body:JSON.stringify({
      employee_id: employeeId,
      riwayat
    })
  });

  const data = await res.json();
  loading.style.display='none';

  if(!res.ok){
    console.error(data);
    return alert('Gagal menghitung gaji');
  }

  output.textContent =
`# TOTAL GAJI MINGGUAN
Nama : ${data.employee.nama}
Jabatan : ${data.employee.jabatan}
Total Duty : ${data.total_jam} jam
Gaji Pokok : ${data.gaji_jabatan.toLocaleString('id-ID')}
Total Gaji per Jam : ${data.gaji_jam.toLocaleString('id-ID')}
======================
**TOTAL GAJI : ${data.total_gaji.toLocaleString('id-ID')}**
======================

${mention}`;
}


function copyText(){
  navigator.clipboard.writeText(
    document.getElementById('output').textContent
  );
  alert('Berhasil dicopy!');
}

function tambahPetugas(){
  const nama = prompt('Nama petugas');
  const jabatan = prompt('Jabatan\n === List === \n 1. ceo trans \n 2. wakil trans \n 3. supervisor \n 4. senior \n 5. junior \n 6. magang');
  if(!nama||!jabatan) return;

  fetch(API_PRIVATE+'/employees',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({nama,jabatan})
  }).then(()=>{
    employeeLoaded=false;
    loadEmployees();
  });
}

async function editPetugas(){
  const id = employeeSelect.value;
  if(!id) return alert('Pilih petugas dulu');

  const opt = employeeSelect.selectedOptions[0];
  const nama = prompt('Nama baru', opt.textContent);
  const jabatan = prompt('Jabatan baru', opt.dataset.jabatan);
  if(!nama||!jabatan) return;

  await fetch(API_PRIVATE+'/employees/'+id,{
    method:'PUT',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({nama,jabatan})
  });

  employeeLoaded=false;
  loadEmployees();
}
</script>

</body>
</html>
